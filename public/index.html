<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abyss-api</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<style>
body {
  margin: 0;
  font-family: "Cairo", sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  overflow: hidden;
  background: #000;
}

#bg-video {
  position: fixed;
  top: 0;
  left: 0;
  min-width: 100%;
  min-height: 100%;
  z-index: -1;
  object-fit: cover;
  object-position: center;
}

.container {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
}

.form-box {
  background: rgba(0, 0, 0, 0.8);
  position: relative;
  padding: 25px;
  border-radius: 20px;
  box-shadow: 0 0 25px rgba(0, 200, 255, 0.7);
  text-align: center;
  width: 280px;
  max-width: 90%;
  color: #fff;
  display: flex;
  flex-direction: column;
  animation: fadeIn 1s ease, electricGlow 3s infinite;
  opacity: 1; /* Ø¸Ø§Ù‡Ø± Ø¯Ø§Ø¦Ù…Ù‹Ø§ */
  visibility: visible; /* Ø¸Ø§Ù‡Ø± Ø¯Ø§Ø¦Ù…Ù‹Ø§ */
  transition: opacity 0.3s ease, visibility 0.3s ease;
}

.form-box.hide {
  opacity: 0; /* ØªØ®ØªÙÙŠ ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§ */
  visibility: hidden;
}

.card-avatar {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  border: 2px solid #00e0ff;
  box-shadow: 0 0 10px #00e0ff, 0 0 20px #00e0ff inset;
  overflow: hidden;
  background: rgba(0,0,0,0.25);
  display: flex;
  justify-content: center;
  align-items: center;
  position: absolute;
  top: -35px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 2;
  animation: electricGlow 3s infinite;
}

.card-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 50%;
}

.form-box h2 {
  margin-bottom: 15px;
  font-weight: 700;
  font-size: 18px;
  color: #00e0ff;
  text-shadow: 0 0 8px #00e0ff;
}

.input-group {
  display: flex;
  align-items: center;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  margin: 8px 0;
  padding: 8px 12px;
  transition: 0.3s;
}

.input-group i {
  color: #00e0ff;
  margin-left: 8px;
  transition: 0.3s;
  text-shadow: 0 0 8px rgba(0, 224, 255, 0.6);
}

.input-group input {
  flex: 1;
  border: none;
  outline: none;
  background: rgba(0,0,0,0.2);
  color: #fff;
  font-size: 13px;
  padding: 6px;
  border-radius: 5px;
}

.input-group input::placeholder {
  color: #ccc;
}

.input-group:focus-within {
  box-shadow: 0 0 12px #00e0ff;
  background: rgba(0, 200, 255, 0.15);
}

.input-group:focus-within i {
  color: #fff;
  animation: pulseIcon 1s infinite;
  text-shadow: 0 0 12px #00e0ff, 0 0 24px #00e0ff;
}

.form-box button {
  width: 100%;
  padding: 10px;
  margin-top: 12px;
  border: none;
  border-radius: 10px;
  background: linear-gradient(90deg, #00e0ff, #0077ff);
  color: #fff;
  font-size: 14px;
  cursor: pointer;
  transition: 0.3s;
}

.form-box button:hover {
  background: linear-gradient(90deg, #0077ff, #00e0ff);
  box-shadow: 0 0 15px #00e0ff;
}

.hidden { display: none; }

.message-box, .welcome-box {
  padding: 10px 15px;
  border-radius: 8px;
  font-weight: bold;
  width: 280px;
  max-width: 90%;
  text-align: center;
  position: fixed; /* Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø§Ø´Ø© */
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: none;
  z-index: 1000;
  background: rgba(0,0,0,0.85);
  animation: fadeIn 0.3s ease;
}

.message-box.error { 
  color: #ff5555; 
  box-shadow: 0 0 15px #ff5555; 
}

.welcome-box { 
  color: #00ff99; 
  box-shadow: 0 0 15px #00ff99; 
}

/* Custom Select Discord Style */
.custom-select {
  position: relative;
  flex: 1;
  background: rgba(0,0,0,0.2);
  border-radius: 5px;
  cursor: pointer;
  color: #fff;
  user-select: none;
}

.custom-select .selected {
  padding: 6px;
  display: flex;
  align-items: center;
}

.custom-select .options {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: rgba(10,10,10,0.95);
  max-height: 200px;
  overflow-y: auto;
  border-radius: 0 0 5px 5px;
  z-index: 5;
  box-shadow: 0 0 10px #00e0ff;
}

.custom-select .options li {
  padding: 8px 10px;
  list-style: none;
  transition: 0.2s;
  display: flex;
  align-items: center;
  gap: 6px;
}

.custom-select .options li:hover {
  background: rgba(0, 200, 255, 0.2);
  color: #00e0ff;
  border-radius: 5px;
}

/* Animations */
@keyframes fadeIn { 
  from { opacity:0; transform:scale(0.9);}
  to { opacity:1; transform:scale(1);}
}
@keyframes pulseIcon {
  0%{transform:scale(1);opacity:1;}
  50%{transform:scale(1.2);opacity:0.8;}
  100%{transform:scale(1);opacity:1;}
}
@keyframes electricGlow {
  0%,100%{box-shadow:0 0 25px rgba(0,200,255,0.7);}
  50%{box-shadow:0 0 45px rgba(0,200,255,1),0 0 70px rgba(0,200,255,0.6);}
}
</style>
<body>

  <video autoplay muted loop playsinline id="bg-video">
    <source src="https://files.catbox.moe/t1r7ws.mp4" type="video/mp4">
  </video>

  <div class="container">

    <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£/Ø§Ù„Ù†Ø¬Ø§Ø­ -->
    <div id="message-box" class="message-box hidden"></div>

    <!-- Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
    <div id="welcome-box" class="welcome-box hidden"></div>

    <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div class="form-box" id="login-box">
      <div class="card-avatar">
        <img src="https://files.catbox.moe/caohoh.jpg" alt="Avatar">
      </div>
      <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <div class="input-group">
        <i class="fa-solid fa-envelope"></i>
        <input type="email" id="login-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
      </div>
      <div class="input-group">
        <i class="fa-solid fa-lock"></i>
        <input type="password" id="login-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
      </div>
      <button type="button" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
      <p>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ
        <a href="javascript:void(0)" onclick="toggleForms()">Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¢Ù†</a>
      </p>
    </div>

    <!-- ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ -->
    <div class="form-box hidden" id="register-box">
      <div class="card-avatar">
        <img src="https://files.catbox.moe/caohoh.jpg" alt="Avatar">
      </div>
      <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
      <div class="input-group">
        <i class="fa-solid fa-user"></i>
        <input type="text" id="reg-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
      </div>
      <div class="input-group">
        <i class="fa-solid fa-flag"></i>
        <div class="custom-select" id="country-select">
          <div class="selected">Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø©</div>
          <ul class="options hidden" id="country-options"></ul>
        </div>
      </div>
      <div class="input-group">
        <i class="fa-solid fa-phone"></i>
        <input type="text" id="reg-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
      </div>
      <div class="input-group">
        <i class="fa-solid fa-envelope"></i>
        <input type="email" id="reg-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
      </div>
      <div class="input-group">
        <i class="fa-solid fa-lock"></i>
        <input type="password" id="reg-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
      </div>
      <button type="button" onclick="register()">ØªØ³Ø¬ÙŠÙ„</button>
      <p>Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ
        <a href="javascript:void(0)" onclick="toggleForms()">Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„</a>
      </p>
    </div>
  </div>

  <script type="module">import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCBTPlQVGgqL1MmDuZRSJMlS244AtAzZ6E",
  authDomain: "web-zone-c95aa.firebaseapp.com",
  projectId: "web-zone-c95aa",
  storageBucket: "web-zone-c95aa.firebasestorage.app",
  messagingSenderId: "776469157795",
  appId: "1:776469157795:web:d69518695895cff22e2c16",
  measurementId: "G-9NLEWJYZ6J"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ØªÙˆÙ„ÙŠØ¯ ID Ø¹Ø´ÙˆØ§Ø¦ÙŠ
function generateId() {
  return Math.floor(1000000000 + Math.random() * 9000000000).toString();
}

// Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
function showMessage(msg, type="error") {
  const messageBox = document.getElementById("message-box");
  const loginBox = document.getElementById("login-box");
  const registerBox = document.getElementById("register-box");
  messageBox.textContent = msg;
  messageBox.className = type==="error" ? "message-box error" : "message-box success";
  messageBox.style.display = "block";

  loginBox.style.visibility = "hidden";
  registerBox.style.visibility = "hidden";

  setTimeout(()=>{
    messageBox.style.display = "none";
    loginBox.style.visibility = "visible";
    registerBox.style.visibility = "visible";
  }, 3000);
}

// Ø§Ù„ØªØ±Ø­ÙŠØ¨
function showWelcome(msg) {
  const welcomeBox = document.getElementById("welcome-box");
  welcomeBox.textContent = msg;
  welcomeBox.style.display = "block";
}

// Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ÙƒØ§Ø±Ø¯ÙŠÙ†
window.toggleForms = function() {
  const loginBox = document.getElementById("login-box");
  const registerBox = document.getElementById("register-box");
  loginBox.classList.toggle("hidden");
  registerBox.classList.toggle("hidden");
};

// ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
window.register = async function() {
  const name = document.getElementById("reg-name").value;
  const phone = document.getElementById("reg-phone").value;
  const email = document.getElementById("reg-email").value;
  const password = document.getElementById("reg-password").value;

  // Ø§Ù„Ø¯ÙˆÙ„
  const selected = document.getElementById("reg-phone");
  const countryName = selected.dataset.name;
  const countryCode = selected.dataset.code;
  const countryFlag = selected.dataset.flag;

  if(!name || !phone || !email || !password || !countryName){
    showMessage("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆÙ„Ø©", "error");
    return;
  }

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    await setDoc(doc(db, "users", user.uid), {
      id: generateId(),
      name: name,
      country: countryName,
      countryCode: countryCode,
      countryFlag: countryFlag,
      phone: phone,
      email: email,
      role: "user"
    });

    showMessage("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!", "success");
    toggleForms();

  } catch (error) {
    let msg = "âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    if(error.code==="auth/email-already-in-use") msg="âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ù‹Ø§";
    else if(error.code==="auth/invalid-email") msg="âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­";
    else if(error.code==="auth/weak-password") msg="âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©";
    showMessage(msg, "error");
    console.error(error);
  }
};

// ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
window.login = async function() {
  const email = document.getElementById("login-email").value;
  const password = document.getElementById("login-password").value;

  if(!email || !password){
    showMessage("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", "error");
    return;
  }

  try {
    await signInWithEmailAndPassword(auth, email, password);
    showWelcome(`ğŸ‰ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ!`);
    setTimeout(()=>{
      window.location.href = "pages/home/index.html";
    }, 1500);
  } catch(error) {
    let msg = "âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
    showMessage(msg, "error");
    console.error(error);
  }
};

// ======= Discord style Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆÙ„ =======
const countrySelect = document.getElementById("country-select");
const selectedDiv = countrySelect.querySelector(".selected");
const optionsList = document.getElementById("country-options");
const phoneInput = document.getElementById("reg-phone");

let countriesList = [];

async function loadCountries() {
  try {
    const res = await fetch("assets/Settings/countries.json");
    const countries = await res.json();
    countries.sort((a,b)=>a.name.localeCompare(b.name));
    countriesList = countries;

    // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© options
    optionsList.innerHTML = "";
    countries.forEach(c => {
      const li = document.createElement("li");
      li.className = "option-item";
      li.dataset.name = c.name;
      li.dataset.code = c.code;
      li.dataset.flag = c.flag;
      li.textContent = `${c.flag} ${c.name} (+${c.code})`;
      li.addEventListener("click", () => {
        selectedDiv.textContent = `${c.flag} ${c.name}`;
        phoneInput.value = `+${c.code}`;
        phoneInput.dataset.name = c.name;
        phoneInput.dataset.code = c.code;
        phoneInput.dataset.flag = c.flag;

        optionsList.classList.add("hidden");
      });
      optionsList.appendChild(li);
    });

    // Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    if(countries.length > 0){
      const first = countries[0];
      selectedDiv.textContent = `${first.flag} ${first.name}`;
      phoneInput.value = `+${first.code}`;
      phoneInput.dataset.name = first.name;
      phoneInput.dataset.code = first.code;
      phoneInput.dataset.flag = first.flag;
    }

  } catch(err) {
    console.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„", err);
  }
}

loadCountries();

// ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ selected
selectedDiv.addEventListener("click", () => {
  optionsList.classList.toggle("hidden");
});

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
document.addEventListener("click", (e) => {
  if(!countrySelect.contains(e.target)){
    optionsList.classList.add("hidden");
  }
});</script>
</body>
</html>
